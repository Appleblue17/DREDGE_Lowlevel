# DREDGE Lowlevel
## Intro
本次比赛为降低难度，主要的编程都在上层机构（MaixCam）上实现，STM32中提前烧录好能驱动轮子的代码，同学们只需要正确接线即可。

本仓库中包含

- stm32驱动程序，包含轮组电机与舵机驱动代码，鼓励各个参赛队伍自主学习并通过修改该程序提升底层控制器性能。如果需要下载器，请联系组委会。
- MaixCam双板串口通信程序API，参赛队伍需要自主实现底盘移动速度Vx,Vy,Vw以及舵机角度的计算，再使用该API发送给下板，从而驱动轮子、舵机转动。

大致的程序实现架构如图
<center><img src="Pics/pic.png"></center>

## Structure
本仓库大致结构如下，其中较为重要的文件在下方有标注，供各个队伍对提供的代码架构有一个较为清晰的认识，并能够较快的上手开发任务。

```
├── C-Board // 底层控制板程序文件夹
├── Pics
├── MaixCam // 示例主程序与API
|   ├── dredge
│   └── main.py
└── README.md
```
> [!NOTE]
> 请在`main.py`下完成主程序的撰写，调用所有模块，并使用MaixVision左下角的`Run Project`，才能保证运行成功。
## Protocal
底层控制器的设计中，采用串口与MaixCam控制板进行通信，遵循以下通讯协议。对小车的控制只需将MaixCam与底层控制板串口连接即可。
- 波特率：115200
- 包头：0xA5
    -  包头正确，是通讯包被正确识别的第一步
- 数据帧
    - Vx, Vy, Vw : 范围在 [-3, 3] 内的浮点数
    - MotorPos : 范围在 [0, 180] 内的舵机角度列表，共6个，可供参赛队伍设置
- 校验位
    - 本通讯协议采用CRC16校验，校验位的设置确保了通讯的安全性
    - 如果校验不通过，信息不会被接收

 ## API
 如果你不想进行底层调试，请只关注 `dredge`，CBoard中涉及的嵌入式开发知识不要求掌握。请使用培训时介绍的Maix开发平台MaixVision进行python程序编写并直接下载到MaixCam开发板进行调试。

 请将 `dredge` 文件夹放到你的开发文件夹下，使用 `import` 相关方式直接导入该API、API中的函数或变量，设置你的底层控制指令，如
 ```python
 from dredge.apriltagmap import map
 ```
 以获得AprilTag对应坐标的字典

## Usage
 API应当有详细的用法注释， 如果对API的使用有疑问、发现其中存在bug或开发过程中出现无法解决错误，欢迎提交issue并向组委会反馈。

 软件答疑(Tutorials)时间为
 - 周一、三 20:00-22:00
 - 周六、日 15:00-17:00
 
 注意在答疑中不允许提问代码具体实现相关问题，包括解释API函数使用、函数结构等内容，学长学姐有权利选择不回答。答疑内容可以询问python相关知识、代码具体bug不知道怎么修、下位机通讯不成功等。

 请在每次组委会说要求更新的时候，使用`git pull`拉取最新的代码到本地，如果不想直接替换修改，请运行`git fetch`查看远程仓库的更新。

